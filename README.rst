ledgeR
------

.. image:: https://travis-ci.org/trevorld/ledgeR.png?branch=master
    :target: https://travis-ci.org/trevorld/ledgeR
    :alt: Build Status

.. image:: https://img.shields.io/codecov/c/github/trevorld/ledgeR/master.svg
    :target: https://codecov.io/github/trevorld/ledgeR?branch=master
    :alt: Coverage Status

``ledgeR`` is an R package to import data from plaintext accounting software like Ledger, HLedger, and Beancount into an R data frame for convenient analysis and plotting.

Right now it supports reading in the register from ``ledger``, ``hledger`` files and ``beancount`` files.  

Install
=======

This package depends on `R <https://cran.r-project.org/>`_ and the R packages ``dplyr``, ``rio``, and ``rlang``.

This package also has some system dependencies depending on which plaintext accounting files you wish to read to be able to read in:

ledger
    * `ledger <https://www.ledger-cli.org/>`_ (>= 3.1)

hledger
    * `hledger <http://hledger.org/>`_ (>= 1.4)

beancount
    * `beancount <http://furius.ca/beancount/>`_ (>= 2.0)
    * `hledger <http://hledger.org/>`_ (>= 1.4)

To run the unit tests you'll also need the suggested R package ``testthat``.

To install the development version of the ``ledgeR`` package use the ``install_github`` function from the ``devtools`` package in R::
    
    if(!require("devtools")) { install.packages("devtools") }
    devtools::install_github("trevorld/ledgeR")

Examples
========

The main function is ``register`` which reads in the register of a plaintext accounting file.  This package also exports S3 methods so one can use ``rio::import`` to read in a register.  Here is an example reading in the example beancount file generated by ``bean-example``::

    > library("ledgeR")
    > example_beancount_file <- tempfile(fileext = ".beancount")
    > system(paste("bean-example -o", example_beancount_file), ignore.stderr=TRUE)
    > df <- register(example_beancount_file)
    > head(df)
            date     payee                          description
    1 2016-01-01      <NA> Opening Balance for checking account
    2 2016-01-01      <NA> Opening Balance for checking account
    3 2016-01-01      <NA>   Allowed contributions for one year
    4 2016-01-01      <NA>   Allowed contributions for one year
    5 2016-01-04 BANK FEES                     Monthly bank fee
    6 2016-01-04 BANK FEES                     Monthly bank fee
                           account    amount commodity historical_cost market_value
    1      Assets:US:BofA:Checking   4380.85       USD         4380.85      4380.85
    2      Equity:Opening-Balances  -4380.85       USD        -4380.85     -4380.85
    3 Income:US:Federal:PreTax401k -18000.00    IRAUSD       -18000.00    -18000.00
    4 Assets:US:Federal:PreTax401k  18000.00    IRAUSD        18000.00     18000.00
    5      Assets:US:BofA:Checking     -4.00       USD           -4.00        -4.00
    6      Expenses:Financial:Fees      4.00       USD            4.00         4.00
      mark
    1    *
    2    *
    3    *
    4    *
    5    *
    6    *

One can also use ``rio::import`` to read in the register::

    > df2 <- rio::import(example_beancount_file)
    > all.equal(df, df2)
    [1] TRUE

``rio::convert`` is convenient to converting plaintext accounting files to other file formats such as a csv file::


    $ bean-example -o example.beancount
    $ Rscript --default-packages=ledgeR,rio -e 'convert("example.beancount", "example.csv")'

An example of using the ``flags`` argument to filter on any of the tags starting with ``#trip`` in the example beancount file::

    > df <- register(example_beancount_file, flags="tag:Tag=#trip")
    > head(df)
            date payee description                    account amount commodity
    1 2016-08-20    NA          NA Liabilities:US:Chase:Slate -75.00       USD
    2 2016-08-20    NA          NA   Expenses:Food:Restaurant  75.00       USD
    3 2016-08-20    NA          NA Liabilities:US:Chase:Slate -52.64       USD
    4 2016-08-20    NA          NA   Expenses:Food:Restaurant  52.64       USD
    5 2016-08-20    NA          NA Liabilities:US:Chase:Slate  -4.74       USD
    6 2016-08-20    NA          NA       Expenses:Food:Coffee   4.74       USD
      historical_cost market_value mark
    1          -75.00       -75.00    *
    2           75.00        75.00    *
    3          -52.64       -52.64    *
    4           52.64        52.64    *
    5           -4.74        -4.74    *
    6            4.74         4.74    *
    > suppressPackageStartupMessages(library("dplyr"))
    > dplyr::filter(df, grepl("Expenses", account)) %>% group_by(account) %>% 
    + summarise(trip_total = sum(amount))
    # A tibble: 2 x 2
      account                  trip_total
      <chr>                         <dbl>
    1 Expenses:Food:Coffee           59.1
    2 Expenses:Food:Restaurant     1151. 

**Note:** There is currently a bug in ``bean-report`` that leads us to lose the payee and description for any transactions that uses a ``#tag`` (or ``^link``) tag in a beancount file.
